<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.springGroupS12.dao.MemberDAO">
	<select id="getTotRecCnt" resultType="int">
		SELECT count(idx) FROM member 
		<if test="flag == 'new'">WHERE startDate >= date_add(now(), interval -7 day)</if>;
	</select>
	<select id="getMemberList" resultType="com.spring.springGroupS12.vo.MemberVO">
		SELECT * FROM member WHERE userDelete = '활동' AND level != 99<if test="level != 100"> AND level = #{level}</if> ORDER BY mid LIMIT #{startIndexNo}, #{pageSize};
	</select>
	<select id="getMemberMid" resultType="com.spring.springGroupS12.vo.MemberVO">
		SELECT * FROM member WHERE mid = #{mid};
	</select>
	<select id="getMemberNickName" resultType="com.spring.springGroupS12.vo.MemberVO">
		SELECT * FROM member WHERE nickName = #{nickName};
	</select>
	<select id="getMemberEmail" resultType="com.spring.springGroupS12.vo.MemberVO">
		SELECT * FROM member WHERE email = #{email};
	</select>
	<select id="getMemberListAdmin" resultType="com.spring.springGroupS12.vo.MemberVO">
		SELECT * FROM member WHERE level != 99<if test="level != 100"> AND level = #{level}</if> ORDER BY mid;
	</select>
	<select id="getMemberSearch" resultType="com.spring.springGroupS12.vo.MemberVO">
		SELECT * FROM member WHERE ${search} LIKE concat("%"#{searchStr}"%");
	</select>
	
	<select id="getSubScriptList" resultType="com.spring.springGroupS12.vo.SubScriptVO">
		SELECT * FROM sub_script <if test="mid != '전체'">WHERE mid = #{mid}</if>;
	</select>
	<select id="getSubScript" resultType="int">
		SELECT count(subContent) FROM sub_script WHERE subContent LIKE concat(#{vo.subContent}"%") AND mid = #{vo.mid};
	</select>
	
	
	
	<insert id="setSignUpMember">
		INSERT INTO member VALUES(DEFAULT,#{vo.mid},#{vo.pwd},#{vo.nickName},#{vo.name},#{vo.age},#{vo.email},
			#{vo.address},#{vo.content},#{vo.userInfo},#{vo.myImage},DEFAULT,DEFAULT,DEFAULT,DEFAULT,DEFAULT);
	</insert>
	<insert id="setKakaoMemberInput">
		INSERT INTO member(mid, pwd, nickName, name, age, email) VALUES(#{mid},#{pwd},#{nickName},#{nickName},#{age},#{email});
	</insert>
	
	<insert id="setSubScript">
		INSERT INTO sub_script VALUES(DEFAULT,#{vo.mid},#{vo.nickName},#{vo.subContent},DEFAULT,DEFAULT);
	</insert>
	
	
	<update id="setMemberTempPwd">
		UPDATE member SET pwd = #{tempPwd} WHERE mid = #{mid}; 
	</update>
	<update id="setLastDateUpdate">
		UPDATE member SET lastDate = now() WHERE mid = #{mid};
	</update>
	<update id="setMemberDelete">
		UPDATE member SET level = 999, userDelete = '삭제', lastDate = now() WHERE mid = #{mid};
	</update>
	<update id="setMemberUpdate">
		UPDATE member SET nickName = #{vo.nickName}, name = #{vo.name}, age = #{vo.age}, 
		email = #{vo.email}, address = #{vo.address}, content = #{vo.content}, userInfo = #{vo.userInfo}, myImage = #{vo.myImage}
			where mid = #{vo.mid};
	</update>
	<update id="setMemberPointUp">
		UPDATE member SET point = point + 100 WHERE mid = #{mid};
	</update>
	<update id="setProductProgressSWUpdate">
		UPDATE sub_script SET subProgress = #{subProgress} WHERE idx = #{idx};
	</update>
	
	
	
	<delete id="setSubScriptDelete">
		DELETE FROM sub_script WHERE idx = #{idx};
	</delete>
</mapper>