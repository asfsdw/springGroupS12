<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.springGroupS12.dao.ReplyDAO">
	<select id="getReply" resultType="com.spring.springGroupS12.vo.ReplyVO">
		SELECT * FROM reply WHERE parentIdx = #{parentIdx} ORDER BY reOrder;
	</select>
	<select id="getBoardParentReplyCheck" resultType="com.spring.springGroupS12.vo.ReplyVO">
		SELECT * FROM reply WHERE parentIdx = #{parentIdx} ORDER BY reOrder DESC LIMIT 1;
	</select>
	<select id="getBoardParentReplyIdxCheck" resultType="com.spring.springGroupS12.vo.ReplyVO">
		SELECT * FROM reply WHERE idx = #{idx} ORDER BY reOrder DESC LIMIT 1;
	</select>
	<select id="getReview" resultType="com.spring.springGroupS12.vo.ReplyVO">
		SELECT * FROM reply WHERE part = #{part} AND parentIdx = #{parentIdx} LIMIT 1;
	</select>
	<select id="getProductReplyList" resultType="com.spring.springGroupS12.vo.ReplyVO">
		SELECT * FROM reply WHERE part = #{part} AND parentIdx = #{parentIdx};
	</select>
	
	
	<insert id="setReply">
		INSERT INTO reply 
			<if test="vo.star != 0">
				VALUES(DEFAULT,#{vo.parentIdx},#{vo.part},#{vo.mid},#{vo.nickName},#{vo.content},DEFAULT,DEFAULT,
				#{vo.star},#{vo.hostIP},DEFAULT)
			</if>
			<if test="vo.star == 0 and vo.hostIP == null">
				VALUES(DEFAULT,#{vo.parentIdx},#{vo.part},#{vo.mid},#{vo.nickName},#{vo.content},${vo.reStep},${vo.reOrder},
				DEFAULT,DEFAULT,DEFAULT)
			</if>
			<if test="vo.star == 0 and vo.hostIP != null">
				VALUES(DEFAULT,#{vo.parentIdx},#{vo.part},#{vo.mid},#{vo.nickName},#{vo.content},${vo.reStep},${vo.reOrder},
				DEFAULT,#{vo.hostIP},DEFAULT)
			</if>;
	</insert>
	
	
	
	<update id="setReplyOrderUp">
		UPDATE reply SET reOrder = reOrder + 1 WHERE parentIdx = #{parentIdx} and reOrder > #{reOrder};
	</update>
	<update id="setReplyUpdate">
		UPDATE reply SET content = #{vo.content}, replyDate = now() WHERE idx = #{vo.idx};
	</update>
	<update id="setReplyDelete">
		UPDATE reply SET content = '삭제된 댓글입니다.' WHERE idx = #{idx};
	</update>
	
	
	
	<delete id="setReviewDelete">
		DELETE FROM reply WHERE idx = #{idx};
	</delete>
</mapper>